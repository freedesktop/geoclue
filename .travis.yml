sudo: required
language: c

services:
- docker

jobs:
  include:
  - script: docker run ubuntu:trusty /bin/sh -c "sed -i '/^#\sdeb-src /s/^#//' '/etc/apt/sources.list' && apt-get update && apt-get build-dep --yes geoclue-2.0 && apt-get install --yes git gobject-introspection libmm-glib-dev wget libnotify-dev xsltproc gtk-doc-tools && wget https://ftp.gnu.org/gnu/gettext/gettext-0.19.8.1.tar.xz && tar xf gettext-0.19.8.1.tar.xz && cd gettext-0.19.8.1 && ./configure && make -j && make install && ldconfig && cd .. && git clone --depth 50 --recurse-submodules https://github.com/freedesktop/ModemManager.git && cd ModemManager && ./autogen.sh --without-udev --without-mbim --without-qmi && make -j && make install && cd .. && git clone --depth 50 --recurse-submodules https://gitlab.freedesktop.org/geoclue/geoclue && cd geoclue && ./autogen.sh --disable-nmea-source && make -j && make -j check && make install"
    # Ubuntu 14.04/trusty doesn't provide a package for `libgeoclue-2.0` (`geoclue-2.0` isn't sufficient)
  - script: docker run ubuntu:xenial /bin/sh -c "sed -i '/^#\sdeb-src /s/^#//' '/etc/apt/sources.list' && apt-get update && apt-get build-dep --yes libgeoclue-2-dev && apt-get install --yes git gobject-introspection libmm-glib-dev wget libnotify-dev xsltproc gtk-doc-tools && wget https://ftp.gnu.org/gnu/gettext/gettext-0.19.8.1.tar.xz && tar xf gettext-0.19.8.1.tar.xz && cd gettext-0.19.8.1 && ./configure && make -j && make install && ldconfig && cd .. && git clone --depth 50 --recurse-submodules https://github.com/freedesktop/ModemManager.git && cd ModemManager && ./autogen.sh --without-udev --without-mbim --without-qmi && make -j && make install && cd .. && git clone --depth 50 --recurse-submodules https://gitlab.freedesktop.org/geoclue/geoclue && cd geoclue && ./autogen.sh --disable-nmea-source && make -j && make -j check && make install"
  - script: docker run ubuntu:artful /bin/sh -c "sed -i '/^#\sdeb-src /s/^#//' '/etc/apt/sources.list' && apt-get update && apt-get build-dep --yes libgeoclue-2-dev && apt-get install --yes git gobject-introspection libmm-glib-dev wget libnotify-dev xsltproc gtk-doc-tools && wget https://ftp.gnu.org/gnu/gettext/gettext-0.19.8.1.tar.xz && tar xf gettext-0.19.8.1.tar.xz && cd gettext-0.19.8.1 && ./configure && make -j && make install && ldconfig && cd .. && git clone --depth 50 --recurse-submodules https://github.com/freedesktop/ModemManager.git && cd ModemManager && ./autogen.sh --without-udev --without-mbim --without-qmi && make -j && make install && cd .. && git clone --depth 50 --recurse-submodules https://gitlab.freedesktop.org/geoclue/geoclue && cd geoclue && ./autogen.sh --disable-nmea-source && make -j && make -j check && make install"
  - script: docker run ubuntu:bionic /bin/sh -c "sed -i '/^#\sdeb-src /s/^#//' '/etc/apt/sources.list' && apt-get update && apt-get build-dep --yes libgeoclue-2-dev && apt-get install --yes git gobject-introspection libmm-glib-dev wget libnotify-dev xsltproc gtk-doc-tools && wget https://ftp.gnu.org/gnu/gettext/gettext-0.19.8.1.tar.xz && tar xf gettext-0.19.8.1.tar.xz && cd gettext-0.19.8.1 && ./configure && make -j && make install && ldconfig && cd .. && git clone --depth 50 --recurse-submodules https://github.com/freedesktop/ModemManager.git && cd ModemManager && ./autogen.sh --without-udev --without-mbim --without-qmi && make -j && make install && cd .. && git clone --depth 50 --recurse-submodules https://gitlab.freedesktop.org/geoclue/geoclue && cd geoclue && ./autogen.sh --disable-nmea-source && make -j && make -j check && make install"
    # Further packages are installed as these are new dependencies for the latest source code, compared to the dependencies listed in the distribution version (`apt-get build-dep` always refers to the version which is built for the OS rather than the up-to-date source)
